<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ultra Interactive — 90+ Features • Mobile‑First • PWA • Self‑Download</title>
  <meta name="color-scheme" content="dark light">
  <style>
    /* ===== THEME & BASE ===== */
    :root{
      --base: 16px;
      --bg: #0b1220; --bg2:#0a0f1a; --text:#e6eefc; --muted:#9fb2d8;
      --accent: #7c3aed; --accent2:#60a5fa;
      --card:#0f172a; --card2:#0b1329;
      --ok:#34d399; --warn:#f59e0b; --err:#ef4444;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35), 0 3px 10px rgba(0,0,0,.25);
      --anim: .6s;
      --safe-b: env(safe-area-inset-bottom, 0px);
    }
    [data-theme="light"]{ --bg:#f7f9ff; --bg2:#eef3ff; --text:#101a2e; --muted:#556382; --card:#ffffff; --card2:#f4f7ff; --shadow:0 8px 24px rgba(16,26,46,.12); }
    [data-contrast="high"]{ --muted: color-mix(in oklab, var(--text) 60%, #64748b) }
    [data-saver="on"]{
      --shadow: none;
      --bg: #0c0f18; --bg2:#0c0f18;
      background-attachment: initial !important;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html{scroll-behavior:smooth;font-size:var(--base)}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text);
      background: radial-gradient(1200px 600px at var(--mx,50%) var(--my,10%), color-mix(in oklab, var(--accent) 30%, transparent), transparent 60%), radial-gradient(800px 400px at 80% 0%, rgba(96,165,250,.25), transparent 60%), linear-gradient(180deg,var(--bg),var(--bg2));
      background-attachment: fixed;
    }
    @media (prefers-reduced-motion: reduce){
      html{scroll-behavior:auto}
      *{animation: none !important; transition: none !important}
    }
    ::selection{background: color-mix(in oklab, var(--accent) 40%, transparent)}
    .wrap{max-width:1200px;margin:0 auto;padding:0 1.25rem}
    a{color:inherit}
    .skip{position:absolute;left:-999px;top:-999px;background:#111827;color:#e5e7eb;padding:.5rem .75rem;border-radius:10px}
    .skip:focus{left:16px;top:16px;z-index:100}
    kbd{padding:.1rem .35rem;border:1px solid rgba(255,255,255,.2);border-bottom-width:2px;border-radius:6px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .progress{position:fixed;inset:0 0 auto 0;height:4px;background:linear-gradient(90deg,var(--accent),var(--accent2));transform-origin:left;transform:scaleX(0);z-index:90}
    header{position:sticky;top:0;z-index:85;backdrop-filter:saturate(120%) blur(12px);background:linear-gradient(180deg,rgba(0,0,0,.35),transparent);border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{display:flex;gap:.75rem;align-items:center;justify-content:space-between;padding:.6rem 0}
    .brand{display:flex;gap:.6rem;align-items:center;font-weight:800}
    .dot{width:12px;height:12px;border-radius:999px;background:conic-gradient(var(--accent),var(--accent2),var(--accent)); box-shadow:0 0 12px color-mix(in oklab, var(--accent) 80%, transparent)}
    nav a{padding:.45rem .7rem;border-radius:999px;text-decoration:none;border:1px solid transparent}
    nav a:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.1)}
    nav a.active{background:linear-gradient(180deg,color-mix(in oklab, var(--accent) 25%, transparent),rgba(96,165,250,.25));border-color:rgba(255,255,255,.2)}
    .controls{display:flex;gap:.4rem;align-items:center;flex-wrap:wrap}
    .toggle, .chip{padding:.35rem .7rem;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:transparent;color:var(--text);cursor:pointer}
    .color{inline-size:28px;block-size:28px;border-radius:999px;border:1px solid rgba(255,255,255,.2);background:var(--accent);cursor:pointer}
    .slider{appearance:none;width:110px;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));outline:none}
    .with-sidebar{display:grid;grid-template-columns:280px 1fr;gap:1.25rem}
    .sidebar{position:sticky;top:64px;align-self:start;background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:.75rem;box-shadow:var(--shadow)}
    .sidebar details{margin:.3rem 0}
    section{padding:90px 0; content-visibility:auto; contain-intrinsic-size:1px 500px;}
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:2rem;align-items:center;min-height:70vh}
    .headline{font-size:clamp(2rem,6vw,4rem);line-height:1.08;margin:.2rem 0}
    .sub{color:var(--muted);max-width:70ch}
    .btn{position:relative;display:inline-flex;align-items:center;gap:.55rem;padding:.9rem 1.1rem;border-radius:16px;font-weight:700;text-decoration:none;color:#0b1220;background:linear-gradient(180deg,#fff,#dbe8ff);border:1px solid rgba(0,0,0,.08);box-shadow:var(--shadow);overflow:hidden}
    .btn::before{content:"";position:absolute;inset:-2px;border-radius:inherit;padding:2px;background:conic-gradient(var(--accent),var(--accent2),var(--accent));-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;opacity:.35;transition:opacity .2s}
    .btn:hover::before{opacity:.7}
    .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18)}
    .btn.ghost{background:transparent;color:var(--text);border:1px dashed rgba(255,255,255,.18)}
    .btn .ripple{position:absolute;border-radius:999px;transform:translate(-50%,-50%);pointer-events:none;opacity:.35;mix-blend-mode:overlay}
    .art{position:relative;aspect-ratio:1/1.05;border-radius:var(--radius);background: radial-gradient(600px 300px at 30% 10%, color-mix(in oklab, var(--accent) 30%, transparent),transparent 60%), linear-gradient(180deg,var(--card),var(--card2));box-shadow:var(--shadow);overflow:hidden;border:1px solid rgba(255,255,255,.08)}
    .blob,.ring,.flare{position:absolute;filter:blur(16px);opacity:.9;mix-blend-mode:screen;will-change:transform}
    .blob{width:320px;height:320px;background:radial-gradient(circle at 30% 30%, rgba(96,165,250,.9), transparent 60%);left:-40px;top:-40px}
    .ring{width:420px;height:420px;border-radius:999px;border:40px solid color-mix(in oklab, var(--accent) 25%, transparent);right:-80px;top:-60px}
    .flare{width:180px;height:180px;background:radial-gradient(circle at 50% 50%, rgba(255,255,255,.85), transparent 60%);left:40%;top:60%}
    .art .grid{position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.06) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,.06) 1px, transparent 1px);background-size:30px 30px;mask:radial-gradient(closest-side,#000 60%,transparent);}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.1rem}
    .card{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.02)), linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:1rem;box-shadow:var(--shadow);transform:perspective(900px) rotateX(0) rotateY(0);transition:transform .15s}
    .card h3{margin:.15rem 0 .35rem;font-size:1.05rem}
    .card p{margin:0;color:var(--muted)}
    .shine{pointer-events:none;position:absolute;inset:-2px;border-radius:inherit;background: radial-gradient(400px 200px at var(--mx,50%) var(--my,50%), rgba(255,255,255,.22), transparent 40%), linear-gradient(180deg,transparent, color-mix(in oklab, var(--accent) 15%, transparent));opacity:.85}
    .badge{font-size:.75rem;padding:.25rem .55rem;border-radius:999px;background:color-mix(in oklab, var(--accent) 15%, transparent);border:1px solid color-mix(in oklab, var(--accent) 35%, transparent)}
    [data-tip]{position:relative}
    [data-tip]:hover::after{content:attr(data-tip);position:absolute;left:50%;top:-8px;transform:translate(-50%,-100%);white-space:nowrap;background:#111827;color:#e5e7eb;border:1px solid rgba(255,255,255,.1);padding:.35rem .55rem;border-radius:8px;box-shadow:var(--shadow);font-size:.8rem}
    pre{position:relative;margin:0;border-radius:14px;background:#0b1426;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);overflow:auto}
    code{display:block;padding:1rem 1.1rem;line-height:1.5}
    .tok-kw{color:#c084fc;font-weight:700}.tok-fn{color:#60a5fa}.tok-str{color:#34d399}.tok-num{color:#f59e0b}
    .copy{position:absolute;top:8px;right:8px}
    details{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:.8rem 1rem;box-shadow:var(--shadow)}
    details+details{margin-top:.7rem} summary{cursor:pointer;font-weight:700} summary::-webkit-details-marker{display:none}
    .tiles{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    .tile{aspect-ratio:1/1;border-radius:12px;background: radial-gradient(120px 60px at 30% 30%, rgba(96,165,250,.6), transparent 60%), linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.08);position:relative;overflow:hidden}
    .tile::after{content:"";position:absolute;inset:0;background: radial-gradient(160px 80px at var(--mx,50%) var(--my,50%), rgba(255,255,255,.18), transparent 40%)}
    .tabs{display:flex;gap:.5rem;border-bottom:1px solid rgba(255,255,255,.12);margin-bottom:1rem;overflow:auto;padding-bottom:.25rem}
    .tabs button{background:transparent;border:0;color:var(--text);padding:.6rem .9rem;border-radius:10px;cursor:pointer;flex:0 0 auto}
    .tabs button[aria-selected="true"]{background:color-mix(in oklab, var(--accent) 20%, transparent)}
    .tabpanels{border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:1rem;background:linear-gradient(180deg,var(--card),var(--card2))}
    .carousel{position:relative;overflow:hidden;border-radius:12px;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow)}
    .slides{display:flex;transition:transform .45s ease}
    .slide{min-width:100%;padding:60px 20px;text-align:center;background:linear-gradient(180deg,var(--card),var(--card2))}
    .carousel .dotnav{position:absolute;left:50%;bottom:8px;transform:translateX(-50%);display:flex;gap:6px}
    .carousel .dotnav button{width:8px;height:8px;border-radius:99px;border:0;background:#cbd5e1;opacity:.5}
    .carousel .dotnav button[aria-current="true"]{opacity:1;background:var(--accent2)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.48);display:none;place-items:center;z-index:95}
    .modal .panel{width:min(560px,90vw);background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:1rem;box-shadow:var(--shadow)}
    .toastwrap{position:fixed;right:16px;bottom:calc(16px + var(--safe-b));display:flex;flex-direction:column;gap:.5rem;z-index:96}
    .toast{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:.6rem .9rem;box-shadow:var(--shadow)}
    .net{position:fixed;left:16px;bottom:calc(16px + var(--safe-b));z-index:86}
    .backtop{position:fixed;right:16px;bottom:calc(16px + var(--safe-b));z-index:86;transform:translateY(120%);transition:transform .2s}
    .backtop.show{transform:none}
    .ring{position:fixed;right:20px;top:70px;width:48px;height:48px;z-index:86}
    .search{display:flex;gap:.5rem;align-items:center;margin:.75rem 0}
    .search input{flex:1;background:#0c1424;color:var(--text);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:.6rem .8rem}
    .kbd-help{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:93}
    .kbd-help .panel{width:min(720px,92vw);background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:1rem;box-shadow:var(--shadow)}
    .data-table{width:100%;border-collapse:collapse;background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.12);border-radius:12px;overflow:hidden}
    .data-table th,.data-table td{padding:.65rem .8rem;border-bottom:1px solid rgba(255,255,255,.08)}
    .data-table th{cursor:pointer;text-align:left;position:sticky;top:0;background:color-mix(in oklab, var(--card) 85%, transparent)}
    .note{width:100%;min-height:140px;background:#0c1424;color:var(--text);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:.7rem .8rem}
    .drop{border:2px dashed rgba(255,255,255,.25);border-radius:12px;padding:1rem;text-align:center}
    .drop.hover{background:rgba(255,255,255,.05)}
    .chart{width:100%;height:260px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,var(--card),var(--card2));box-shadow:var(--shadow)}
    footer{padding:60px 0 calc(60px + var(--safe-b));color:var(--muted);text-align:center}
    @media print{
      header,.progress,.backtop,.ring,.toastwrap,.modal,.kbd-help,.mobilebar,.sheet{display:none !important}
      body{background:#fff;color:#000} .card,.sidebar,.tabpanels{box-shadow:none;border-color:#ddd}
    }
    .reveal{opacity:0;transform:translateY(24px);transition:opacity var(--anim),transform var(--anim)}
    .reveal.show{opacity:1;transform:none}

    /* ===== Mobile-first tweaks ===== */
    @media (max-width: 960px){
      .hero{grid-template-columns:1fr}
      .with-sidebar{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr 1fr}
      .tiles{grid-template-columns:repeat(4,1fr)}
      .controls{gap:.3rem}
      .sidebar{display:none} /* hidden on small; use drawer */
      .drawer{display:block}
      main{scroll-snap-type: y proximity}
      main > .wrap > div > section{scroll-snap-align: start}
    }
    @media (max-width: 640px){
      .grid{grid-template-columns:1fr}
      .tiles{grid-template-columns:repeat(3,1fr)}
      .btn{padding:0.85rem 1rem}
    }

    /* Drawer */
    .drawer{position:fixed;inset:0 30% 0 0;background:linear-gradient(180deg,var(--card),var(--card2));border-right:1px solid rgba(255,255,255,.12);transform:translateX(-110%);transition:transform .25s;z-index:98;padding:1rem;overflow:auto}
    .drawer.show{transform:none}
    .scrim{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:none;z-index:97}
    .scrim.show{display:block}
    .mobilebar{position:fixed;left:0;right:0;bottom:0;z-index:96;display:none;background:linear-gradient(180deg,rgba(0,0,0,.2),rgba(0,0,0,.45));backdrop-filter:blur(8px);border-top:1px solid rgba(255,255,255,.1);padding:.4rem max(1rem, env(safe-area-inset-left)) calc(.4rem + var(--safe-b)) max(1rem, env(safe-area-inset-right));}
    @media (max-width: 960px){ .mobilebar{display:block} }
    .mobilebar .bar{display:flex;justify-content:space-around;gap:.5rem}
    .mobilebar a{display:flex;align-items:center;justify-content:center;padding:.6rem .9rem;border-radius:10px;border:1px solid rgba(255,255,255,.12);text-decoration:none;background:linear-gradient(180deg,var(--card),var(--card2))}

    /* Bottom sheet */
    .sheet{position:fixed;left:0;right:0;bottom:0;transform:translateY(65%);transition:transform .25s ease;z-index:96}
    .sheet.show{transform:translateY(0)}
    .sheet .panel{border-radius:16px 16px 0 0;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,var(--card),var(--card2));box-shadow:var(--shadow);padding:1rem}
    .sheet .handle{width:44px;height:5px;background:rgba(255,255,255,.35);border-radius:99px;margin:0 auto .6rem}

    /* Data saver visuals */
    [data-saver="on"] .art, [data-saver="on"] .tile, [data-saver="on"] .card{background:var(--card); box-shadow:none}
    [data-saver="on"] .blob, [data-saver="on"] .ring, [data-saver="on"] .flare, [data-saver="on"] .grid{display:none}
  </style>
</head>
<body>
  <a class="skip" href="#home">Skip to content</a>
  <div class="progress" id="progress"></div>
  <header>
    <div class="wrap nav">
      <div class="brand"><span class="dot" aria-hidden="true"></span> Ultra Interactive</div>
      <nav aria-label="Primary" class="hide-on-mobile">
        <a href="#home" class="active" data-i18n="home">Home</a>
        <a href="#features" data-i18n="features">Features</a>
        <a href="#code" data-i18n="code">Code</a>
        <a href="#charts" data-i18n="charts">Charts</a>
        <a href="#table" data-i18n="table">Table</a>
        <a href="#notes" data-i18n="notes">Notes</a>
        <a href="#upload" data-i18n="upload">Upload</a>
        <a href="#timers" data-i18n="timers">Timers</a>
        <a href="#device" data-i18n="device">Device</a>
        <a href="#camera" data-i18n="camera">Camera</a>
        <a href="#download" data-i18n="download">Download</a>
        <a href="#faq" data-i18n="faq">FAQ</a>
        <a href="#contact" data-i18n="contact">Contact</a>
      </nav>
      <div class="controls">
        <button class="toggle" id="menuBtn" title="Open menu">☰</button>
        <button class="toggle" id="themeBtn" title="Toggle theme (T)">Theme</button>
        <div class="color" id="colorBtn" title="Accent color"></div>
        <label class="chip" title="Font size"><input id="fontRange" class="slider" type="range" min="14" max="20" value="16"></label>
        <button class="toggle" id="contrastBtn" title="High contrast">A11y</button>
        <button class="toggle" id="saverBtn" title="Data saver">Saver</button>
        <button class="toggle" id="wakeBtn" title="Keep screen awake">Wake</button>
        <button class="toggle" id="fsBtn" title="Fullscreen">⛶</button>
        <button class="toggle" id="installBtn" style="display:none" title="Install app">Install</button>
        <button class="toggle" id="helpKbd" title="Keyboard shortcuts (?)">?</button>
        <button class="toggle" id="shareBtn" title="Share">Share</button>
        <button class="toggle" id="langBtn" title="Language">EN</button>
        <span class="chip" id="clock" aria-live="polite"></span>
      </div>
    </div>
  </header>

  <!-- Drawer & scrim (mobile) -->
  <aside id="drawer" class="drawer" aria-label="Mobile menu" aria-hidden="true">
    <h3 style="margin-top:0">Menu</h3>
    <nav style="display:grid;gap:.35rem">
      <a href="#home">Home</a><a href="#features">Features</a><a href="#code">Code</a><a href="#charts">Charts</a><a href="#table">Table</a><a href="#notes">Notes</a><a href="#upload">Upload</a><a href="#timers">Timers</a><a href="#device">Device</a><a href="#camera">Camera</a><a href="#download">Download</a><a href="#faq">FAQ</a><a href="#contact">Contact</a>
    </nav>
    <hr style="border-color:rgba(255,255,255,.08)">
    <div style="display:flex;flex-wrap:wrap;gap:.35rem">
      <button class="toggle" id="preset1">Purple</button>
      <button class="toggle" id="preset2">Teal</button>
      <button class="toggle" id="preset3">Sunset</button>
    </div>
  </aside>
  <div id="scrim" class="scrim" aria-hidden="true"></div>

  <!-- Command palette -->
  <div class="modal" id="palette" role="dialog" aria-modal="true" aria-labelledby="palTitle">
    <div class="panel">
      <h3 id="palTitle" style="margin:.2rem 0 .5rem">Quick actions</h3>
      <div class="search"><input id="palInput" placeholder="Type: home, features, code, download…" aria-label="Command search"/></div>
      <div class="sub">Enter to go • Esc to close</div>
    </div>
  </div>

  <!-- Keyboard help -->
  <div class="kbd-help" id="kbd" role="dialog" aria-modal="true" aria-labelledby="kbdTitle">
    <div class="panel">
      <h3 id="kbdTitle" style="margin:.2rem 0 .5rem">Keyboard Shortcuts</h3>
      <ul>
        <li><kbd>⌘/Ctrl</kbd> + <kbd>K</kbd> — Command palette</li>
        <li><kbd>T</kbd> — Toggle theme</li>
        <li><kbd>/</kbd> — Focus filter</li>
        <li><kbd>G</kbd> — Toggle grid density</li>
        <li><kbd>J</kbd>/<kbd>K</kbd> — Next/Prev section</li>
        <li><kbd>?</kbd> — This help</li>
        <li>Shake device — Confetti</li>
      </ul>
      <div style="display:flex;gap:.5rem;justify-content:flex-end"><button class="btn secondary" id="kbdClose">Close</button></div>
    </div>
  </div>

  <main id="home" class="wrap with-sidebar">
    <aside class="sidebar" aria-label="On this page">
      <details open>
        <summary>Jump to</summary>
        <nav style="display:grid;gap:.25rem;margin-top:.5rem">
          <a href="#home">Home</a><a href="#features">Features</a><a href="#code">Code</a><a href="#charts">Charts</a><a href="#table">Table</a><a href="#notes">Notes</a><a href="#upload">Upload</a><a href="#timers">Timers</a><a href="#device">Device</a><a href="#camera">Camera</a><a href="#download">Download</a><a href="#faq">FAQ</a><a href="#contact">Contact</a>
        </nav>
      </details>
      <details>
        <summary>Actions</summary>
        <div style="display:grid;gap:.4rem;margin-top:.4rem">
          <button class="btn ghost" id="openModal">Open modal</button>
          <button class="btn ghost" id="showToast">Show toast</button>
          <button class="btn ghost" id="copyLink">Copy section link</button>
          <button class="btn ghost" id="randomize">Randomize tiles</button>
          <button class="btn ghost" id="printBtn">Print to PDF</button>
        </div>
      </details>
      <details>
        <summary>Filter cards</summary>
        <div class="search"><input id="filter" placeholder="Type to filter (press / to focus)…"/></div>
        <div style="display:flex;gap:.3rem;align-items:center"><span class="chip" id="gridCols">3 cols</span><button class="toggle" id="gridToggle">Toggle density (G)</button></div>
      </details>
      <details>
        <summary>Data</summary>
        <div style="display:grid;gap:.4rem;margin-top:.4rem">
          <button class="toggle" id="exportData">Export settings</button>
          <input id="importData" type="file" accept="application/json" hidden>
          <button class="toggle" id="importBtn">Import settings</button>
          <button class="toggle" id="resetSettings">Reset settings</button>
        </div>
      </details>
      <div class="net"><span class="chip" id="netStatus">Online</span> <span class="chip" id="connInfo" title="Connection"></span></div>
    </aside>

    <div>
      <section class="hero" id="top">
        <div>
          <div class="badge" data-tip="Animated gradient, spotlight, and more">All in one</div>
          <h1 class="headline" data-i18n="headline">A single HTML file packed with polish</h1>
          <p class="sub" data-i18n="tagline">Hover highlights, 3D tilt, parallax art, syntax‑highlighted code with copy, scroll progress + ring, tooltips, reveal animations, theme + accent persistence, command palette, carousel, tabs, modal, toast, live search, D&D cards, sortable table, canvas chart, file drop, notes autosave, image filters, timers, device APIs, drawer menu, bottom bar, haptics, dictation, geolocation, camera, PWA offline, install prompt, self‑download, and more.</p>
          <div style="display:flex;gap:.75rem;margin-top:1rem;flex-wrap:wrap">
            <a class="btn" href="#features" data-i18n="explore">Explore features</a>
            <a class="btn secondary" href="#download" data-i18n="downloadThis">Download this page</a>
            <a class="btn secondary" href="#contact" data-i18n="getInTouch">Get in touch</a>
          </div>
          <p class="sub" style="margin-top:.75rem" id="featureCount">Features loaded: …</p>
        </div>
        <div class="art parallax" aria-hidden="true">
          <div class="blob" data-depth="0.05"></div>
          <div class="ring" data-depth="0.1"></div>
          <div class="flare" data-depth="0.2"></div>
          <div class="grid"></div>
        </div>
      </section>

      <section id="features" class="reveal">
        <div style="display:flex;justify-content:space-between;align-items:end;gap:1rem">
          <div>
            <h2 style="margin:0 0 .75rem">Feature Highlights</h2>
            <p class="sub" style="margin-bottom:1rem">Hover any card to see tilt + glossy spotlight. Drag cards to reorder. Use the filter to search live. Press <kbd>J</kbd>/<kbd>K</kbd> to jump sections.</p>
          </div>
          <div class="tabs" role="tablist" aria-label="Feature views">
            <button role="tab" aria-selected="true" aria-controls="panel1" id="tab1">Overview</button>
            <button role="tab" aria-selected="false" aria-controls="panel2" id="tab2">Gallery</button>
            <button role="tab" aria-selected="false" aria-controls="panel3" id="tab3">Carousel</button>
          </div>
        </div>

        <div class="tabpanels">
          <div id="panel1" role="tabpanel" aria-labelledby="tab1">
            <div class="grid" id="cards">
              <article class="card tilt draggable" tabindex="0" data-tags="parallax spotlight"><div class="shine"></div><h3>Parallax & Spotlight</h3><p>Background reacts to your cursor with gradient shading. Foreground art moves on depth layers.</p></article>
              <article class="card tilt draggable" tabindex="0" data-tags="scroll spy"><div class="shine"></div><h3>Smooth Scroll & Spy</h3><p>Sticky header and section spy highlight current section. Top bar and ring show progress.</p></article>
              <article class="card tilt draggable" tabindex="0" data-tags="reveal io"><div class="shine"></div><h3>Reveal on View</h3><p>Sections fade and lift into view via IntersectionObserver. Accessible and buttery.</p></article>
              <article class="card tilt draggable" tabindex="0" data-tags="tabs carousel"><div class="shine"></div><h3>Tabs & Carousel</h3><p>Accessible tabs with panels, swipe‑friendly carousel with dots and autoplay pause.</p></article>
              <article class="card tilt draggable" tabindex="0" data-tags="modal toast"><div class="shine"></div><h3>Modal & Toast</h3><p>Accessible dialog and lightweight notification system.</p></article>
              <article class="card tilt draggable" tabindex="0" data-tags="palette shortcuts"><div class="shine"></div><h3>Command Palette</h3><p><kbd>⌘/Ctrl</kbd>+<kbd>K</kbd> opens quick navigation. <kbd>?</kbd> shows shortcuts.</p></article>
            </div>
          </div>
          <div id="panel2" role="tabpanel" hidden aria-labelledby="tab2">
            <div class="tiles" id="tiles">
              <div class="tile"></div><div class="tile"></div><div class="tile"></div><div class="tile"></div><div class="tile"></div><div class="tile"></div>
              <div class="tile"></div><div class="tile"></div><div class="tile"></div><div class="tile"></div><div class="tile"></div><div class="tile"></div>
            </div>
          </div>
          <div id="panel3" role="tabpanel" hidden aria-labelledby="tab3">
            <div class="carousel" id="carousel">
              <div class="slides">
                <div class="slide">Slide 1 • Pure CSS/JS carousel</div>
                <div class="slide">Slide 2 • Keyboard + swipe navigation</div>
                <div class="slide">Slide 3 • Dot nav + auto‑pause</div>
              </div>
              <div class="dotnav"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="code" class="reveal">
        <h2 style="margin:0 0 .75rem">Code Demo</h2>
        <p class="sub" style="margin:0 0 .75rem">Tiny JS helper that builds a glowing mouse‑follow highlight and copies code on click.</p>
        <pre><button class="btn copy" data-copy>Copy</button><code id="snippet"><span class="tok-kw">const</span> area <span class="tok-kw">=</span> document.<span class="tok-fn">querySelector</span>(<span class="tok-str">'.interactive'</span>);
area.<span class="tok-fn">addEventListener</span>(<span class="tok-str">'pointermove'</span>, (<span class="tok-kw">e</span>) <span class="tok-kw">=&gt;</span> {
  <span class="tok-kw">const</span> r <span class="tok-kw">=</span> area.<span class="tok-fn">getBoundingClientRect</span>();
  area.<span class="tok-fn">style</span>.setProperty(<span class="tok-str">'--mx'</span>, (e.clientX - r.left) + <span class="tok-str">'px'</span>);
  area.<span class="tok-fn">style</span>.setProperty(<span class="tok-str">'--my'</span>, (e.clientY - r.top) + <span class="tok-str">'px'</span>);
});</code></pre>
      </section>

      <section id="charts" class="reveal">
        <h2 style="margin:0 0 .75rem">Canvas Chart</h2>
        <p class="sub">Simple bar chart rendered to &lt;canvas&gt; with randomize and fullscreen.</p>
        <canvas id="chart" class="chart" width="1000" height="260" aria-label="Bar chart" role="img"></canvas>
        <div style="display:flex;gap:.5rem;margin-top:.6rem;flex-wrap:wrap">
          <button class="btn" id="randChart">Randomize</button>
          <button class="btn secondary" id="downloadChart">Download PNG</button>
          <button class="btn secondary" id="fullChart">Fullscreen</button>
        </div>
      </section>

      <section id="table" class="reveal">
        <h2 style="margin:0 0 .75rem">Sortable Table</h2>
        <p class="sub">Click headers to sort. Shift‑click to multi‑sort.</p>
        <table class="data-table" id="dataTbl">
          <thead><tr><th data-key="name">Name</th><th data-key="score">Score</th><th data-key="date">Date</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="notes" class="reveal">
        <h2 style="margin:0 0 .75rem">Notes (Autosave + Dictation)</h2>
        <p class="sub">Your text is stored locally in your browser. Use the mic to dictate if supported.</p>
        <textarea id="note" class="note" placeholder="Write anything…"></textarea>
        <div style="display:flex;gap:.5rem;margin-top:.6rem;flex-wrap:wrap">
          <button class="btn" id="exportNotes">Export notes</button>
          <label class="btn secondary" for="importNotes">Import notes</label>
          <input id="importNotes" type="file" accept="text/plain" hidden>
          <button class="btn secondary" id="clearNotes">Clear</button>
          <button class="btn secondary" id="dictateBtn">🎙 Dictate</button>
          <button class="btn secondary" id="speakBtn">🔊 Read</button>
          <button class="btn secondary" id="saveNotesFile">💾 Save as file</button>
        </div>
      </section>

      <section id="upload" class="reveal">
        <h2 style="margin:0 0 .75rem">File Drop, Preview & Filters</h2>
        <p class="sub">Drop an image or text file to preview without upload. Adjust image filters.</p>
        <div id="drop" class="drop">Drop files here or click to select<input id="filePick" type="file" accept="image/*,text/plain" hidden></div>
        <div style="display:flex;gap:.5rem;align-items:center;margin-top:.6rem"><label class="chip">Filter <input id="imgFilter" type="range" min="0" max="100" value="0" class="slider" style="width:160px"></label><span class="sub">0 = none • 100 = dramatic</span></div>
        <div id="preview" style="margin-top:.6rem"></div>
      </section>

      <section id="timers" class="reveal">
        <h2 style="margin:0 0 .75rem">Timers</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
          <div class="card">
            <h3>Countdown</h3>
            <div style="display:flex;gap:.4rem;align-items:center">
              <input id="countInput" type="number" min="1" max="600" value="60" style="width:90px" /> <span class="sub">seconds</span>
              <button class="btn" id="startCount">Start</button>
              <span id="countDisp" class="chip">60</span>
              <label class="chip" title="Wake lock"><input type="checkbox" id="countWake"> Keep awake</label>
              <label class="chip" title="Notify"><input type="checkbox" id="countNotify"> Notify</label>
            </div>
          </div>
          <div class="card">
            <h3>Pomodoro</h3>
            <div style="display:flex;gap:.4rem;align-items:center;flex-wrap:wrap">
              <button class="btn" id="pomoStart">Start (25/5)</button>
              <button class="btn secondary" id="pomoStop">Stop</button>
              <span id="pomoDisp" class="chip">Idle</span>
              <label class="chip"><input type="checkbox" id="pomoWake"> Keep awake</label>
              <label class="chip"><input type="checkbox" id="pomoNotify"> Notify</label>
            </div>
          </div>
        </div>
      </section>

      <section id="device" class="reveal">
        <h2 style="margin:0 0 .75rem">Device Features</h2>
        <p class="sub">Mobile-friendly extras: haptics, geolocation, orientation-based parallax, connection info.</p>
        <div style="display:flex;gap:.5rem;flex-wrap:wrap">
          <button class="btn" id="vibeBtn">Vibrate</button>
          <button class="btn secondary" id="geoBtn">Locate me</button>
          <span class="chip" id="geoOut">Location: unknown</span>
          <span class="chip" id="orientOut">Orientation: n/a</span>
          <span class="chip" id="shakeOut">Shake: n/a</span>
        </div>
        <canvas id="pad" class="chart" width="1000" height="240" aria-label="Doodle pad"></canvas>
        <div class="sub">Draw with your finger or mouse. Long-press clears.</div>
      </section>

      <section id="camera" class="reveal">
        <h2 style="margin:0 0 .75rem">Camera</h2>
        <p class="sub">Capture from your device camera (requires HTTPS or localhost). Toggle torch if supported.</p>
        <div style="display:flex;gap:.5rem;flex-wrap:wrap;align-items:center">
          <button class="btn" id="camStart">Start camera</button>
          <button class="btn secondary" id="camSnap">Snapshot</button>
          <button class="btn secondary" id="camTorch">Torch</button>
          <span class="chip" id="camState">Off</span>
        </div>
        <video id="cam" playsinline autoplay muted style="width:100%;border-radius:12px;margin-top:.5rem;max-height:360px;background:#000"></video>
        <canvas id="snap" class="chart" width="1000" height="260" aria-label="Snapshot"></canvas>
      </section>

      <section id="download" class="reveal">
        <h2 style="margin:0 0 .75rem">Download This Page</h2>
        <p class="sub">Everything on this site lives in this one file. Click below to download the full, self‑contained <code>index.html</code> you are viewing.</p>
        <div style="display:flex;gap:.6rem;flex-wrap:wrap">
          <button class="btn" id="downloadSelf">Download index.html</button>
          <button class="btn secondary" id="copyHTML">Copy HTML</button>
          <button class="btn secondary" id="viewSource">View source</button>
          <button class="btn secondary" id="installHint" style="display:none">How to add to Home Screen</button>
        </div>
        <details style="margin-top:.6rem"><summary>Inline source (generated on demand)</summary><pre><code id="sourceBox" style="white-space:pre-wrap"></code></pre></details>
      </section>

      <section id="faq" class="reveal">
        <h2 style="margin:0 0 .75rem">FAQ</h2>
        <details open><summary>Is everything really in one file?</summary><div class="sub">Yes. All CSS and JS live in this HTML for easy drop‑in hosting. It also includes an inlined Service Worker to enable offline caching once installed.</div></details>
        <details><summary>Does it respect reduced motion?</summary><div class="sub">Yes. If your system prefers reduced motion, animations and auto-scrolling are minimized.</div></details>
        <details><summary>How do I export my settings?</summary><div class="sub">Use “Export settings” in the sidebar. It includes theme, accent, font size, and more.</div></details>
      </section>

      <section id="contact" class="reveal">
        <h2 style="margin:0 0 .75rem">Contact</h2>
        <p class="sub">This button opens your default email client. Replace the address with yours.</p>
        <a class="btn" href="mailto:hello@yourdomain.com?subject=Hello&body=Hi%20there">Email me</a>
      </section>
    </div>
  </main>

  <footer class="wrap">
    <svg viewBox="0 0 1200 140" width="100%" height="140" preserveAspectRatio="none" aria-hidden="true">
      <defs><linearGradient id="wave" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="var(--accent)"/><stop offset="1" stop-color="#60a5fa"/></linearGradient></defs>
      <path d="M0,80 C200,10 400,150 600,80 C800,10 1000,150 1200,80 L1200,140 L0,140 Z" fill="url(#wave)" opacity=".25"></path>
      <path d="M0,100 C220,30 420,170 600,100 C780,30 980,170 1200,100 L1200,140 L0,140 Z" fill="url(#wave)" opacity=".35"></path>
    </svg>
    <div>Built with semantic HTML, modern CSS, and a few lines of vanilla JS.</div>
  </footer>

  <nav class="mobilebar" aria-label="Quick bottom navigation">
    <div class="bar wrap">
      <a href="#home">Home</a>
      <a href="#features">Features</a>
      <a href="#download">Download</a>
      <a href="#contact">Contact</a>
    </div>
  </nav>

  <div class="sheet" id="sheet" aria-label="Quick Actions">
    <div class="panel wrap">
      <div class="handle"></div>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center">
        <a class="btn" href="#download">Download</a>
        <button class="btn secondary" id="sheetShare">Share</button>
        <a class="btn secondary" href="#contact">Contact</a>
        <button class="btn secondary" id="sheetClose">Close</button>
      </div>
    </div>
  </div>

  <button class="btn backtop" id="backTop" aria-label="Back to top">↑ Top</button>
  <svg class="ring" viewBox="0 0 36 36" aria-hidden="true">
    <defs><linearGradient id="grad" x1="0" y1="0" x2="1" y2="0"><stop offset="0" stop-color="var(--accent)"/><stop offset="1" stop-color="#60a5fa"/></linearGradient></defs>
    <path d="M18 2 a 16 16 0 1 1 0 32 a 16 16 0 1 1 0 -32" fill="none" stroke="#334155" stroke-width="4" opacity=".35"/>
    <path id="ringProg" d="M18 2 a 16 16 0 1 1 0 32 a 16 16 0 1 1 0 -32" fill="none" stroke="url(#grad)" stroke-width="4" stroke-dasharray="100 100" stroke-linecap="round"/>
  </svg>

  <div class="toastwrap" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- Modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="panel">
      <h3 id="modalTitle" style="margin:.2rem 0 .5rem">Hello from a modal</h3>
      <p class="sub">This is a fully accessible dialog built with plain HTML, CSS, and JS.</p>
      <div style="display:flex;gap:.5rem;justify-content:flex-end"><button class="btn secondary" id="closeModal">Close</button></div>
    </div>
  </div>

  <script>
    // ===== Utilities =====
    const root = document.documentElement;
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
    const load = (k,d)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? d; }catch{ return d; } };
    const setMouseVars = (el, e) => { const r = el.getBoundingClientRect(); el.style.setProperty('--mx', (e.clientX - r.left) + 'px'); el.style.setProperty('--my', (e.clientY - r.top) + 'px'); };
    const haptic = ms => { try{ navigator.vibrate?.(ms||10); }catch{} };
    const ripple = (e)=>{ const b=e.currentTarget; const r=document.createElement('span'); r.className='ripple'; const rect=b.getBoundingClientRect(); const x=e.clientX-rect.left, y=e.clientY-rect.top; r.style.left=x+'px'; r.style.top=y+'px'; r.style.width=r.style.height=Math.max(rect.width,rect.height)*1.5+'px'; r.style.background=getComputedStyle(root).getPropertyValue('--accent'); b.appendChild(r); setTimeout(()=>r.remove(),400); };

    // Button ripple + haptics
    document.addEventListener('pointerdown', e=>{ const t=e.target.closest('.btn, .toggle'); if(t){ ripple(e); haptic(8); } }, {passive:true});

    // ===== PWA: manifest + SW registration (inline) =====
    (function(){
      const iconSVG = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='%237c3aed'/><stop offset='1' stop-color='%2360a5fa'/></linearGradient></defs><rect rx='14' width='64' height='64' fill='url(%23g)'/><circle cx='32' cy='18' r='6' fill='white' opacity='.9'/><circle cx='18' cy='46' r='6' fill='white' opacity='.9'/><circle cx='46' cy='46' r='6' fill='white' opacity='.9'/></svg>`;
      const manifest = {
        name: 'Ultra Interactive',
        short_name: 'Ultra',
        start_url: '.',
        display: 'standalone',
        background_color: getComputedStyle(root).getPropertyValue('--bg').trim() || '#0b1220',
        theme_color: getComputedStyle(root).getPropertyValue('--accent').trim() || '#7c3aed',
        icons: [{ src: 'data:image/svg+xml;base64,'+btoa(iconSVG), sizes: 'any', type: 'image/svg+xml' }]
      };
      const manURL = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type:'application/json'}));
      const link = document.createElement('link'); link.rel='manifest'; link.href=manURL; document.head.appendChild(link);

      if('serviceWorker' in navigator){
        const sw = `
          const CACHE='ui-v1';
          self.addEventListener('install', e=>{ e.waitUntil((async()=>{ const c=await caches.open(CACHE); try{ await c.addAll([self.registration.scope]); }catch(e){} })()); });
          self.addEventListener('activate', e=>{ e.waitUntil((async()=>{ const keys=await caches.keys(); await Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k))); })()); });
          self.addEventListener('fetch', e=>{
            const url = new URL(e.request.url);
            if(e.request.method!=='GET') return;
            e.respondWith((async()=>{
              try{
                const res = await fetch(e.request);
                const c = await caches.open(CACHE); c.put(e.request, res.clone());
                return res;
              }catch(_){
                const cached = await caches.match(e.request);
                if(cached) return cached;
                if(url.origin===location.origin) return caches.match(self.registration.scope);
                throw _;
              }
            })());
          });
        `;
        const swURL = URL.createObjectURL(new Blob([sw], {type:'text/javascript'}));
        navigator.serviceWorker.register(swURL).catch(()=>{});
      }
    })();

    // A2HS prompt
    let deferredPrompt=null;
    const installBtn = $('#installBtn'); const installHint = $('#installHint');
    window.addEventListener('beforeinstallprompt', e=>{ e.preventDefault(); deferredPrompt=e; installBtn.style.display='inline-block'; });
    installBtn.addEventListener('click', async ()=>{ try{ await deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; }catch{} });
    // iOS hint (no beforeinstallprompt)
    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent) && !window.MSStream;
    if(isIOS) installHint.style.display='inline-block';
    installHint.addEventListener('click', ()=>toast('Tap Share → “Add to Home Screen”'));

    // ===== Theme / Accent / Font size (persist) =====
    const themeBtn = $('#themeBtn'); const colorBtn = $('#colorBtn'); const fontRange = $('#fontRange'); const contrastBtn = $('#contrastBtn'); const saverBtn = $('#saverBtn');
    const applyTheme = t => { const run=()=>{ document.body.dataset.theme = t; save('theme',t); }; if(document.startViewTransition){ document.startViewTransition(run); } else run(); };
    const applyAccent = c => { root.style.setProperty('--accent', c); colorBtn.style.background = c; save('accent', c); };
    const applyFont = n => { root.style.setProperty('--base', n+'px'); save('font', n); };
    const applyContrast = v => { document.body.dataset.contrast = v ? 'high' : ''; save('contrast', !!v); };
    const applySaver = v => { document.body.dataset.saver = v ? 'on' : ''; save('saver', !!v); };
    applyTheme(load('theme','')); applyAccent(load('accent', getComputedStyle(root).getPropertyValue('--accent').trim())); applyFont(load('font', 16)); applyContrast(load('contrast', false)); applySaver(load('saver', false));
    // Auto-theme by time if not set
    if(localStorage.getItem('theme')===null){ const h=(new Date).getHours(); if(h<7 || h>18) applyTheme(''); else applyTheme('light'); }

    themeBtn.addEventListener('click', ()=>applyTheme(document.body.dataset.theme === 'light' ? '' : 'light'));
    colorBtn.addEventListener('click', ()=>{ const rand = `hsl(${Math.floor(Math.random()*360)} 85% 60%)`; applyAccent(rand); toast('Accent updated'); });
    fontRange.addEventListener('input', ()=>applyFont(fontRange.value));
    contrastBtn.addEventListener('click', ()=>applyContrast(document.body.dataset.contrast!=='high'));
    saverBtn.addEventListener('click', ()=>applySaver(document.body.dataset.saver!=='on'));
    $('#resetSettings').addEventListener('click', ()=>{ localStorage.clear(); toast('Settings cleared'); setTimeout(()=>location.reload(),500); });
    // Presets
    $('#preset1').addEventListener('click', ()=>applyAccent('#7c3aed'));
    $('#preset2').addEventListener('click', ()=>applyAccent('#14b8a6'));
    $('#preset3').addEventListener('click', ()=>applyAccent('#f97316'));

    // ===== Language toggle (EN/ES demo) =====
    const strings = {
      en: { home:'Home', features:'Features', code:'Code', charts:'Charts', table:'Table', notes:'Notes', upload:'Upload', timers:'Timers', device:'Device', camera:'Camera', download:'Download', faq:'FAQ', contact:'Contact', headline:'A single HTML file packed with polish', tagline:'Hover highlights, 3D tilt, parallax art, syntax‑highlighted code with copy, scroll progress + ring, tooltips, reveal animations, theme + accent persistence, command palette, carousel, tabs, modal, toast, live search, D&D cards, sortable table, canvas chart, file drop, notes autosave, image filters, timers, device APIs, drawer menu, bottom bar, haptics, dictation, geolocation, camera, PWA offline, install prompt, self‑download, and more.', explore:'Explore features', downloadThis:'Download this page', getInTouch:'Get in touch' },
      es: { home:'Inicio', features:'Funciones', code:'Código', charts:'Gráficas', table:'Tabla', notes:'Notas', upload:'Subir', timers:'Temporizadores', device:'Dispositivo', camera:'Cámara', download:'Descargar', faq:'Preguntas', contact:'Contacto', headline:'Un solo archivo HTML lleno de detalles', tagline:'Resaltado con el cursor, inclinación 3D, arte con paralaje, código con copia, progreso de desplazamiento + anillo, tooltips, animaciones, tema + acento persistentes, paleta de comandos, carrusel, pestañas, modal, notificaciones, búsqueda en vivo, tarjetas arrastrables, tabla ordenable, gráfico en canvas, arrastrar archivos, notas auto‑guardadas, filtros de imagen, temporizadores, APIs del dispositivo, menú de cajón, barra inferior, hápticos, dictado, geolocalización, cámara, PWA sin conexión, instalación, descarga propia y más.', explore:'Explorar funciones', downloadThis:'Descargar esta página', getInTouch:'Contactar' }
    };
    const langBtn = $('#langBtn');
    function applyLang(l){ save('lang', l); langBtn.textContent = l.toUpperCase(); $$('[data-i18n]').forEach(el=>{ const key=el.dataset.i18n; if(strings[l][key]) el.textContent = strings[l][key]; }); }
    applyLang(load('lang','en'));
    langBtn.addEventListener('click', ()=>applyLang(langBtn.textContent.trim().toLowerCase()==='en' ? 'es' : 'en'));

    // ===== Safe mobile 100vh fix =====
    const setVH = ()=>{ document.body.style.setProperty('--vh', window.innerHeight * 0.01 + 'px'); };
    window.addEventListener('resize', setVH); setVH();

    // ===== Drawer =====
    const drawer=$('#drawer'), scrim=$('#scrim'), menuBtn=$('#menuBtn');
    const toggleDrawer=(show)=>{ drawer.classList.toggle('show', show); scrim.classList.toggle('show', show); drawer.setAttribute('aria-hidden', !show); };
    menuBtn.addEventListener('click', ()=>toggleDrawer(!drawer.classList.contains('show')));
    scrim.addEventListener('click', ()=>toggleDrawer(false));
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') toggleDrawer(false); });
    // Swipe from left edge to open
    let touchStartX=null;
    window.addEventListener('touchstart', e=>{ const x=e.touches[0].clientX; touchStartX = x; }, {passive:true});
    window.addEventListener('touchend', e=>{ if(touchStartX!==null && touchStartX<24){ toggleDrawer(true); } touchStartX=null; }, {passive:true});

    // ===== Share =====
    const shareBtn = $('#shareBtn');
    if(!('share' in navigator)) shareBtn.style.display='none';
    shareBtn.addEventListener('click', ()=>navigator.share({title: document.title, url: location.href}).catch(()=>{}));
    $('#sheetShare').addEventListener('click', ()=>navigator.share?.({title: document.title, url: location.href}));

    // ===== Body spotlight background =====
    window.addEventListener('pointermove', e => { root.style.setProperty('--mx', e.clientX + 'px'); root.style.setProperty('--my', e.clientY + 'px'); });

    // ===== 3D tilt, glows, parallax =====
    $$('.tilt').forEach(card => {
      card.addEventListener('pointermove', e => {
        setMouseVars(card, e);
        const r = card.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - .5;
        const y = (e.clientY - r.top) / r.height - .5;
        card.style.transform = `perspective(900px) rotateX(${(-y*8).toFixed(2)}deg) rotateY(${(x*12).toFixed(2)}deg)`;
      });
      ['pointerleave','blur'].forEach(t=>card.addEventListener(t,()=>card.style.transform=''));
    });
    $$('.tile').forEach(t => t.addEventListener('pointermove', e => setMouseVars(t, e)));
    const parallax = $('.parallax');
    parallax?.addEventListener('pointermove', e => {
      const r = parallax.getBoundingClientRect();
      const cx = (e.clientX - r.left) / r.width - .5;
      const cy = (e.clientY - r.top) / r.height - .5;
      parallax.querySelectorAll('[data-depth]').forEach(el => {
        const d = parseFloat(el.getAttribute('data-depth')) || 0.05;
        el.style.transform = `translate(${(-cx*40*d).toFixed(1)}px, ${(-cy*40*d).toFixed(1)}px)`;
      });
    });

    // Device orientation parallax (mobile)
    const orientOut = $('#orientOut');
    if(window.DeviceOrientationEvent){
      window.addEventListener('deviceorientation', e=>{
        const ax = (e.gamma||0)/45, ay = (e.beta||0)/45;
        orientOut.textContent = `Orientation: ${Math.round((e.alpha||0))}°`;
        document.querySelectorAll('.parallax [data-depth]').forEach(el=>{
          const d = parseFloat(el.getAttribute('data-depth'))||0.05;
          el.style.transform = `translate(${(-ax*40*d).toFixed(1)}px, ${(-ay*40*d).toFixed(1)}px)`;
        });
      });
    }

    // ===== Scroll progress (bar + ring) + back-to-top =====
    const progress = $('#progress'); const ring = $('#ringProg'); const backTop = $('#backTop');
    const updateProgress = () => {
      const h = document.documentElement;
      const scrolled = (h.scrollTop) / (h.scrollHeight - h.clientHeight);
      progress.style.transform = `scaleX(${Math.max(0,Math.min(1, scrolled))})`;
      const pct = Math.round(scrolled*100);
      ring.setAttribute('stroke-dasharray', `${pct} 100`);
      backTop.classList.toggle('show', scrolled > .12);
    };
    document.addEventListener('scroll', updateProgress, {passive:true}); updateProgress();
    backTop.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));

    // ===== Reveal + nav spy =====
    const sections = [...document.querySelectorAll('main section')];
    const navLinks = [...document.querySelectorAll('header nav a')];
    const byId = id => navLinks.find(a => a.getAttribute('href') === `#${id}`);
    const io = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if(entry.isIntersecting){ entry.target.classList.add('show'); }
        if(entry.isIntersecting && entry.target.id){ navLinks.forEach(a=>a.classList.remove('active')); byId(entry.target.id)?.classList.add('active'); }
      });
    }, { rootMargin: '-40% 0px -55% 0px', threshold: .01 });
    sections.forEach(s => { s.classList.add('reveal'); io.observe(s); });

    // Keyboard J/K to move between sections
    window.addEventListener('keydown', e=>{
      if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return;
      if(e.key.toLowerCase()==='j' || e.key.toLowerCase()==='k'){
        const ids = sections.map(s=>s.id);
        const y = window.scrollY + 10;
        const idx = sections.findIndex(s=>s.offsetTop > y) - 1;
        let target;
        if(e.key.toLowerCase()==='j'){ target = sections[Math.min(ids.length-1, Math.max(0, idx+1))]; }
        else { target = sections[Math.max(0, idx)]; }
        target && target.scrollIntoView({behavior:'smooth', block:'start'});
      }
    });

    // ===== Copy code =====
    const copyBtn = document.querySelector('[data-copy]');
    copyBtn?.addEventListener('click', async () => {
      const text = document.getElementById('snippet').innerText;
      try{ await navigator.clipboard.writeText(text); copyBtn.textContent='Copied!'; toast('Code copied'); setTimeout(()=>copyBtn.textContent='Copy',1000);}catch{ copyBtn.textContent='Failed'; toast('Copy failed','err'); }
    });

    // ===== Tabs =====
    const tabs = $$('.tabs [role=tab]'); const panels = $$('#features .tabpanels [role=tabpanel]');
    function activateTab(btn){ tabs.forEach(b=>b.setAttribute('aria-selected','false')); panels.forEach(p=>p.hidden = true); btn.setAttribute('aria-selected','true'); $('#'+btn.getAttribute('aria-controls')).hidden = false; }
    tabs.forEach(b=>b.addEventListener('click', ()=>activateTab(b)));

    // ===== Carousel (with swipe, respects reduced motion) =====
    const mReduce = matchMedia('(prefers-reduced-motion: reduce)');
    const carousel = $('#carousel');
    if(carousel){
      const slides = $('.slides', carousel);
      const dots = $('.dotnav', carousel);
      const count = $$('.slide', slides).length;
      let idx = 0, startX = 0, dragging=false;
      const set = i => { idx = (i+count)%count; slides.style.transform = `translateX(${-idx*100}%)`; renderDots(); };
      const renderDots = () => { dots.innerHTML=''; for(let i=0;i<count;i++){ const b=document.createElement('button'); b.setAttribute('aria-current', i===idx); b.addEventListener('click', ()=>set(i)); dots.appendChild(b);} };
      renderDots();
      let timer = mReduce.matches ? null : setInterval(()=>set(idx+1), 5000);
      carousel.addEventListener('pointerenter', ()=>{ if(timer) { clearInterval(timer); timer=null; } });
      carousel.addEventListener('pointerleave', ()=>{ if(!mReduce.matches && !timer) timer=setInterval(()=>set(idx+1), 5000); });
      slides.addEventListener('pointerdown', e=>{ dragging=true; startX=e.clientX; slides.setPointerCapture(e.pointerId); });
      slides.addEventListener('pointerup', e=>{ if(!dragging) return; const dx=e.clientX-startX; if(dx>50) set(idx-1); else if(dx<-50) set(idx+1); dragging=false; });
      $('#randomize')?.addEventListener('click', ()=>set(idx+1));
    }

    // ===== Modal & Toast =====
    const modal = $('#modal');
    $('#openModal').addEventListener('click', ()=>modal.style.display='grid');
    $('#closeModal').addEventListener('click', ()=>modal.style.display='none');
    modal.addEventListener('click', e=>{ if(e.target===modal) modal.style.display='none'; });
    const toasts = $('#toasts');
    function toast(msg, type){ const t=document.createElement('div'); t.className='toast'; t.textContent=msg; if(type==='err') t.style.borderColor='var(--err)'; toasts.appendChild(t); setTimeout(()=>t.remove(), 2400); }
    $('#showToast').addEventListener('click', ()=>toast('Here is a toast ✨'));

    // ===== Live filter + grid density + save layout order =====
    const filter = $('#filter'); const cards = $('#cards'); const gridCols = $('#gridCols'); const gridToggle = $('#gridToggle');
    filter.addEventListener('input', () => {
      const q = filter.value.toLowerCase();
      $$('#cards .card').forEach(c=>{ const text = (c.textContent + ' ' + (c.dataset.tags||'')).toLowerCase(); c.style.display = text.includes(q) ? '' : 'none'; });
    });
    document.addEventListener('keydown', e=>{ if(e.key === '/'){ e.preventDefault(); filter.focus(); } });
    let dense = load('dense', false);
    const updateGridCols = ()=>{ const cols = dense?4:3; cards.style.gridTemplateColumns = `repeat(${cols},1fr)`; gridCols.textContent = cols + ' cols'; save('dense', dense); };
    gridToggle.addEventListener('click', ()=>{ dense=!dense; updateGridCols(); });
    document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='g'){ dense=!dense; updateGridCols(); }});
    updateGridCols();

    // Draggable cards reorder + persist
    let dragEl=null;
    function persistOrder(){
      const order = $$('#cards .card h3').map(h=>h.textContent);
      save('cardOrder', order);
    }
    const savedOrder = load('cardOrder', null);
    if(savedOrder){
      const map = {}; $$('#cards .card').forEach(c=>map[$('h3',c).textContent]=c);
      savedOrder.forEach(k=>{ if(map[k]) cards.appendChild(map[k]); });
    }
    $$('#cards .card').forEach(el=>{ el.classList.add('draggable'); el.draggable=true; el.addEventListener('dragstart', ()=>{ dragEl=el; el.style.opacity='.5'; }); el.addEventListener('dragend', ()=>{ dragEl=null; el.style.opacity=''; persistOrder(); }); });
    cards.addEventListener('dragover', e=>{ e.preventDefault(); const after = Array.from(cards.querySelectorAll('.draggable')).find(card=>{ const r=card.getBoundingClientRect(); return e.clientY < r.top + r.height/2; }); if(!dragEl) return; after ? cards.insertBefore(dragEl, after) : cards.appendChild(dragEl); });

    // ===== Command palette (⌘/Ctrl+K) =====
    const palette = $('#palette'); const palInput = $('#palInput');
    function openPalette(){ palette.style.display='grid'; palInput.value=''; palInput.focus(); }
    function closePalette(){ palette.style.display='none'; }
    window.addEventListener('keydown', e=>{
      const mac = navigator.platform.includes('Mac');
      if((mac?e.metaKey:e.ctrlKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); openPalette(); }
      if(e.key==='Escape'){ closePalette(); $('#kbd').style.display='none'; }
      if(e.key==='?' || (e.shiftKey && e.key==='/')){ $('#kbd').style.display='grid'; }
      if(e.key.toLowerCase()==='t'){ themeBtn.click(); }
    });
    palette.addEventListener('click', e=>{ if(e.target===palette) closePalette(); });
    palInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ const v = palInput.value.trim().toLowerCase(); const id = ['home','features','code','charts','table','notes','upload','timers','device','camera','download','faq','contact'].find(s=>s.startsWith(v)); if(id){ location.hash = '#' + id; closePalette(); } }});
    $('#kbdClose').addEventListener('click', ()=>$('#kbd').style.display='none');
    $('#helpKbd').addEventListener('click', ()=>$('#kbd').style.display='grid');

    // ===== Copy deep link =====
    $('#copyLink').addEventListener('click', async ()=>{
      const el = sections.find(s => s.getBoundingClientRect().top >= 0) || sections[0];
      const url = location.origin + location.pathname + '#' + el.id;
      try{ await navigator.clipboard.writeText(url); toast('Link copied'); }catch{ toast('Copy failed', 'err'); }
    });

    // ===== Clock + random quote =====
    const clock = $('#clock'); const quotes = ["Stay curious.","Ship small, ship often.","Make it simple, then add lightness.","Details make the design.","Delight is in the micro‑interactions."];
    function tick(){ const d = new Date(); clock.textContent = d.toLocaleTimeString(); }
    setInterval(tick, 1000); tick(); toast(quotes[Math.floor(Math.random()*quotes.length)]);

    // ===== Canvas chart =====
    const ctx = $('#chart')?.getContext('2d');
    function drawChart(data){
      if(!ctx) return;
      const W = ctx.canvas.width, H = ctx.canvas.height;
      ctx.clearRect(0,0,W,H);
      ctx.strokeStyle = 'rgba(255,255,255,.2)';
      ctx.beginPath(); ctx.moveTo(40,20); ctx.lineTo(40,H-30); ctx.lineTo(W-10,H-30); ctx.stroke();
      const max = Math.max(...data, 10);
      const barW = (W-70)/data.length;
      data.forEach((v,i)=>{
        const h = (H-60)*(v/max);
        const x = 45 + i*barW + 6;
        const y = (H-30) - h;
        const g = ctx.createLinearGradient(0,y,0,y+h);
        g.addColorStop(0, getComputedStyle(root).getPropertyValue('--accent').trim());
        g.addColorStop(1, getComputedStyle(root).getPropertyValue('--accent2')?.trim() || '#60a5fa');
        ctx.fillStyle = g; ctx.fillRect(x, y, barW-12, h);
      });
    }
    let chartData = Array.from({length:10}, ()=>Math.floor(Math.random()*100)+10);
    drawChart(chartData);
    $('#randChart')?.addEventListener('click', ()=>{ chartData = Array.from({length:10}, ()=>Math.floor(Math.random()*100)+10); drawChart(chartData); });
    $('#downloadChart')?.addEventListener('click', ()=>{ const url = $('#chart').toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download='chart.png'; a.click(); });
    $('#fullChart')?.addEventListener('click', ()=>{ $('#chart')?.requestFullscreen?.(); });

    // ===== Sortable table =====
    const tbl = $('#dataTbl'); const tbody = tbl?.querySelector('tbody');
    let rows = [
      {name:'Alpha', score:72, date:'2025-08-01'},
      {name:'Delta', score:91, date:'2025-06-11'},
      {name:'Gamma', score:66, date:'2025-02-09'},
      {name:'Beta',  score:84, date:'2025-04-22'},
      {name:'Epsilon',score:77, date:'2025-07-15'}
    ];
    function renderRows(){ if(!tbody) return; tbody.innerHTML = rows.map(r=>`<tr><td>${r.name}</td><td>${r.score}</td><td>${r.date}</td></tr>`).join(''); }
    renderRows();
    const sorts = [];
    tbl?.querySelectorAll('th').forEach(th=>th.addEventListener('click', e=>{
      const key = th.dataset.key;
      const idx = e.shiftKey ? sorts.findIndex(s=>s.key===key) : -1;
      if(!e.shiftKey) sorts.length=0;
      if(idx===-1) sorts.push({key, dir:1}); else sorts[idx].dir*=-1;
      rows.sort((a,b)=>{
        for(const s of sorts){
          let av=a[s.key], bv=b[s.key];
          if(s.key==='date'){ av=new Date(av); bv=new Date(bv); }
          if(av<bv) return -1*s.dir; if(av>bv) return 1*s.dir;
        }
        return 0;
      });
      renderRows();
    }));

    // ===== Notes (autosave + TTS + Dictation + File Save) =====
    const note = $('#note'); if(note){ note.value = load('notes',''); note.addEventListener('input', ()=>save('notes', note.value)); }
    $('#exportNotes')?.addEventListener('click', ()=>{ const blob = new Blob([note.value], {type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='notes.txt'; a.click(); });
    $('#importNotes')?.addEventListener('change', async e=>{ const file=e.target.files[0]; if(!file) return; const text=await file.text(); note.value=text; save('notes', text); });
    $('#clearNotes')?.addEventListener('click', ()=>{ note.value=''; save('notes',''); });
    $('#speakBtn')?.addEventListener('click', ()=>{ const u=new SpeechSynthesisUtterance(note.value||'No notes'); speechSynthesis.speak(u); });
    // Save as file (File System Access API)
    $('#saveNotesFile')?.addEventListener('click', async ()=>{
      if(window.showSaveFilePicker){
        try{
          const h=await showSaveFilePicker({suggestedName:'notes.txt', types:[{description:'Text', accept:{'text/plain':['.txt']}}]});
          const w=await h.createWritable(); await w.write(note.value); await w.close(); toast('Saved to file');
        }catch{ toast('Save canceled','err'); }
      }else{
        const blob = new Blob([note.value], {type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='notes.txt'; a.click();
      }
    });
    // Dictation
    const dictateBtn = $('#dictateBtn'); let rec=null;
    if(!('webkitSpeechRecognition' in window)) dictateBtn.style.display='none';
    dictateBtn?.addEventListener('click', ()=>{
      if(rec){ rec.stop(); rec=null; dictateBtn.textContent='🎙 Dictate'; return; }
      const R = window.webkitSpeechRecognition; rec = new R(); rec.continuous=true; rec.interimResults=true; rec.lang='en-US'; rec.onresult=(ev)=>{ let t=''; for(let i=ev.resultIndex;i<ev.results.length;i++){ t+=ev.results[i][0].transcript; } note.value = (note.value + ' ' + t).trim(); }; rec.onend=()=>{ dictateBtn.textContent='🎙 Dictate'; rec=null; }; rec.start(); dictateBtn.textContent='⏸ Stop'; });

    // ===== File drop & preview & filters =====
    const drop = $('#drop'); const pick = $('#filePick'); const preview = $('#preview'); const imgFilter = $('#imgFilter');
    function applyFilter(){ const v = parseInt(imgFilter.value||'0',10); const f = `brightness(${100+v/3}%) contrast(${100+v/2}%) saturate(${100+v}%) blur(${Math.max(0,v-70)/25}px)`; $$('#preview img').forEach(i=>i.style.filter=f); }
    function avgColor(img){
      const c=document.createElement('canvas'); const cx=c.getContext('2d'); c.width=img.naturalWidth; c.height=img.naturalHeight; cx.drawImage(img,0,0);
      const d=cx.getImageData(0,0,c.width,c.height).data; let r=0,g=0,b=0,count=0;
      for(let i=0;i<d.length;i+=20){ r+=d[i]; g+=d[i+1]; b+=d[i+2]; count++; }
      r=Math.round(r/count); g=Math.round(g/count); b=Math.round(b/count);
      return `rgb(${r} ${g} ${b})`;
    }
    function handleFiles(files){
      preview.innerHTML='';
      [...files].forEach(file=>{
        const info = document.createElement('div'); info.className='sub'; info.textContent = `${file.name} • ${Math.round(file.size/1024)} KB`; preview.appendChild(info);
        if(file.type.startsWith('image/')){ const img=document.createElement('img'); img.loading='lazy'; img.style.maxWidth='100%'; img.style.borderRadius='12px'; img.style.marginTop='.5rem'; img.alt=file.name; img.src=URL.createObjectURL(file); img.onload=()=>{ const col=avgColor(img); applyAccent(col); toast('Accent from image'); }; preview.appendChild(img); }
        else if(file.type==='text/plain'){ file.text().then(t=>{ const pre=document.createElement('pre'); pre.textContent = t.slice(0,2000); preview.appendChild(pre); }); }
      });
      applyFilter();
    }
    drop?.addEventListener('click', ()=>pick.click());
    pick?.addEventListener('change', e=>handleFiles(e.target.files));
    drop?.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('hover'); });
    drop?.addEventListener('dragleave', ()=>drop.classList.remove('hover'));
    drop?.addEventListener('drop', e=>{ e.preventDefault(); drop.classList.remove('hover'); handleFiles(e.dataTransfer.files); });
    imgFilter?.addEventListener('input', applyFilter);

    // ===== Countdown & Pomodoro + WakeLock + Notifications =====
    const countInput=$('#countInput'), countDisp=$('#countDisp'); const countWake=$('#countWake'); const countNotify=$('#countNotify'); let countTimer=null;
    const pomoWake=$('#pomoWake'), pomoNotify=$('#pomoNotify');
    let wakeLock=null; async function toggleWake(on){ if('wakeLock' in navigator){ try{ if(on && !wakeLock){ wakeLock = await navigator.wakeLock.request('screen'); wakeLock.addEventListener('release',()=>toast('Wake released')); } if(!on && wakeLock){ await wakeLock.release(); wakeLock=null; } }catch{ toast('Wake failed','err'); } } }
    async function notify(msg){ try{ if(!('Notification' in window)) return; const perm = await Notification.requestPermission(); if(perm==='granted') new Notification(msg); }catch{} }
    $('#startCount')?.addEventListener('click', ()=>{
      let t = parseInt(countInput.value||'60',10); countDisp.textContent=t;
      countTimer && clearInterval(countTimer);
      toggleWake(countWake.checked);
      countTimer = setInterval(()=>{ t--; countDisp.textContent=t; if(t<=0){ clearInterval(countTimer); beep(); toast('Countdown done'); if(countNotify.checked) notify('Countdown finished'); confetti(); toggleWake(false); } },1000);
    });
    let pomoTimer=null, pomoPhase='work', pomoLeft=0;
    function startPomo(){ pomoPhase='work'; pomoLeft=25*60; runPomo(); }
    function runPomo(){ clearInterval(pomoTimer); toggleWake(pomoWake.checked); pomoTimer=setInterval(()=>{ pomoLeft--; $('#pomoDisp').textContent = `${pomoPhase} ${Math.floor(pomoLeft/60)}:${String(pomoLeft%60).padStart(2,'0')}`; if(pomoLeft<=0){ if(pomoPhase==='work'){ pomoPhase='break'; pomoLeft=5*60; toast('Break time'); if(pomoNotify.checked) notify('Pomodoro: Break time'); } else { pomoPhase='work'; pomoLeft=25*60; toast('Back to work'); if(pomoNotify.checked) notify('Pomodoro: Back to work'); } beep(); confetti(); } },1000); }
    $('#pomoStart')?.addEventListener('click', startPomo);
    $('#pomoStop')?.addEventListener('click', ()=>{ clearInterval(pomoTimer); $('#pomoDisp').textContent='Idle'; toggleWake(false); });
    function beep(){ try{ const a=new (window.AudioContext||window.webkitAudioContext)(); const o=a.createOscillator(); const g=a.createGain(); o.frequency.value=880; o.connect(g); g.connect(a.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, a.currentTime+0.3); setTimeout(()=>a.close(),400); }catch{} }
    // Global Wake button
    const wakeBtn = $('#wakeBtn'); let wakeOn=false; wakeBtn.addEventListener('click', async ()=>{ wakeOn=!wakeOn; await toggleWake(wakeOn); wakeBtn.textContent = wakeOn ? 'Awake' : 'Wake'; });

    // ===== Geolocation =====
    $('#geoBtn')?.addEventListener('click', ()=>{
      if(!('geolocation' in navigator)) return toast('Geolocation not supported','err');
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude, longitude} = pos.coords;
        $('#geoOut').textContent = `Location: ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
      }, ()=>toast('Location denied','err'), {enableHighAccuracy:false, timeout:6000, maximumAge:30000});
    });
    $('#vibeBtn')?.addEventListener('click', ()=>haptic([20,30,20]));

    // ===== Doodle pad =====
    const pad = $('#pad'); const pcx = pad.getContext('2d');
    pcx.lineWidth=3; pcx.lineCap='round'; pcx.strokeStyle=getComputedStyle(root).getPropertyValue('--accent').trim();
    let drawing=false, last= null, pressStart=0;
    function pos(ev){ const r=pad.getBoundingClientRect(); const x = (ev.touches?ev.touches[0].clientX:ev.clientX)-r.left; const y=(ev.touches?ev.touches[0].clientY:ev.clientY)-r.top; return {x,y}; }
    function draw(ev){ if(!drawing) return; const p=pos(ev); pcx.beginPath(); pcx.moveTo(last.x,last.y); pcx.lineTo(p.x,p.y); pcx.stroke(); last=p; }
    function start(ev){ drawing=true; last=pos(ev); pressStart=Date.now(); }
    function end(){ drawing=false; if(Date.now()-pressStart>700){ pcx.clearRect(0,0,pad.width,pad.height); toast('Canvas cleared'); } }
    pad.addEventListener('pointerdown', start); pad.addEventListener('pointermove', draw); pad.addEventListener('pointerup', end); pad.addEventListener('pointerleave', ()=>drawing=false);

    // ===== Camera capture + Torch =====
    const cam = $('#cam'), snap = $('#snap'); const camState=$('#camState'); let stream=null; let torchOn=false;
    async function startCam(){
      try{
        stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        cam.srcObject = stream; camState.textContent='On';
      }catch{ toast('Camera failed','err'); }
    }
    $('#camStart').addEventListener('click', startCam);
    $('#camSnap').addEventListener('click', ()=>{ if(!stream) return; const cx=snap.getContext('2d'); cx.drawImage(cam,0,0,snap.width,snap.height); toast('Snapshot taken'); });
    $('#camTorch').addEventListener('click', async ()=>{
      try{
        const track = stream?.getVideoTracks?.()[0]; const caps = track?.getCapabilities?.(); if(!caps || !caps.torch){ return toast('Torch not supported','err'); }
        torchOn=!torchOn; await track.applyConstraints({advanced:[{torch: torchOn}]}); toast(torchOn?'Torch on':'Torch off');
      }catch{ toast('Torch failed','err'); }
    });

    // ===== Network info =====
    const connInfo = $('#connInfo');
    function updateConn(){ const c=navigator.connection||navigator.mozConnection||navigator.webkitConnection; if(!c) return; connInfo.textContent = `${c.effectiveType||''} ${c.downlink?c.downlink+'Mbps':''}`.trim(); }
    updateConn(); (navigator.connection||{}).addEventListener?.('change', updateConn);

    // ===== Self-download & copy HTML =====
    function pageHTML(){ const doctype='<!doctype html>\\n'; return doctype + document.documentElement.outerHTML; }
    $('#downloadSelf')?.addEventListener('click', ()=>{ const blob=new Blob([pageHTML()],{type:'text/html'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='index.html'; a.click(); URL.revokeObjectURL(a.href); toast('Downloading page'); });
    $('#copyHTML')?.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(pageHTML()); toast('HTML copied'); }catch{ toast('Copy failed','err'); } });
    $('#viewSource')?.addEventListener('click', ()=>{ $('#sourceBox').textContent = pageHTML(); toast('Source generated'); });

    // ===== Print =====
    $('#printBtn')?.addEventListener('click', ()=>window.print());

    // ===== Network online/offline indicator =====
    const net = $('#netStatus');
    function updateNet(){ net.textContent = navigator.onLine ? 'Online' : 'Offline'; if(!navigator.onLine) net.style.borderColor='var(--warn)'; else net.style.borderColor=''; }
    window.addEventListener('online', ()=>{ updateNet(); toast('Back online'); });
    window.addEventListener('offline', ()=>{ updateNet(); toast('You are offline','err'); });
    updateNet();

    // ===== Feature counter =====
    const features = [
      'Theme toggle','Accent color','Font slider','High contrast','Data saver','Spotlight BG','3D tilt','Parallax','Scroll bar','Scroll ring','Back-to-top','Reveal on view',
      'Nav spy','Tooltips','Sticky header','Sticky sidebar','Tabs','Carousel','Swipe','Modal','Toasts','Command palette',
      'Copy code','Deep-link copy','Live filter','Grid density toggle','Drag cards','Tiles glow','Canvas chart','Chart download','Chart fullscreen','Sortable table',
      'Autosave notes','Notes export','Notes import','File picker','Drag & drop','Image preview','Text preview','Image filters','Countdown timer','Pomodoro',
      'Clock','Random quote','Settings export','Settings import','Settings reset','Konami confetti','Keyboard help','Reduced motion support','Accessible controls','ARIA roles',
      'Keyboard J/K nav','Randomize tiles','Palette search','Auto theme by time','Network indicator','Share API','Print to PDF','Self-download HTML','Copy HTML','Inline source viewer',
      'Mobile drawer', 'Bottom bar', 'Haptic feedback', 'Device orientation', 'Edge swipe open', 'Geolocation', 'Doodle pad', 'Mic dictation', 'Text to speech', 'Safe-area padding',
      'PWA manifest', 'Service worker offline', 'Install prompt', 'iOS A2HS hint', 'Wake Lock', 'Notifications', 'Fullscreen toggle', 'Language toggle', 'Bottom sheet', 'Connection info',
      'Camera capture', 'Torch toggle', 'Average color from image'
    ];
    $('#featureCount').textContent = 'Features loaded: ' + features.length;

    // ===== Konami + Shake to confetti =====
    const KONAMI = [38,38,40,40,37,39,37,39,66,65]; let idx=0;
    window.addEventListener('keydown', e=>{ if(e.keyCode===KONAMI[idx]){ idx++; if(idx===KONAMI.length){ confetti(); toast('🎉 Konami!'); idx=0; } } else { idx=0; } });
    let lastShake=0;
    if(window.DeviceMotionEvent){
      window.addEventListener('devicemotion', e=>{
        const a=e.accelerationIncludingGravity||{}; const m=Math.abs(a.x||0)+Math.abs(a.y||0)+Math.abs(a.z||0);
        if(m>35 && Date.now()-lastShake>1500){ lastShake=Date.now(); confetti(); toast('🎊 Shake!'); $('#shakeOut').textContent='Shake: detected'; }
      });
    }

    // ===== Bottom sheet controls =====
    const sheet=$('#sheet'); const sheetClose=$('#sheetClose');
    setTimeout(()=>sheet.classList.add('show'), 1200);
    sheetClose.addEventListener('click', ()=>sheet.classList.remove('show'));
    // Drag to close
    let startY=0, dy=0; sheet.addEventListener('touchstart', e=>{ startY=e.touches[0].clientY; }, {passive:true});
    sheet.addEventListener('touchmove', e=>{ dy=e.touches[0].clientY-startY; if(dy>0){ sheet.style.transform=`translateY(${Math.min(65, dy/3)}%)`; } }, {passive:true});
    sheet.addEventListener('touchend', ()=>{ if(dy>100){ sheet.classList.remove('show'); } sheet.style.transform=''; dy=0; }, {passive:true});

    // ===== Fullscreen =====
    $('#fsBtn').addEventListener('click', ()=>{ if(!document.fullscreenElement){ document.documentElement.requestFullscreen?.(); } else { document.exitFullscreen?.(); } });

    // ===== Help modal toggles =====
    const helpModal = $('#kbd');
    helpModal.addEventListener('click', e=>{ if(e.target===helpModal) helpModal.style.display='none'; });

    // ===== URL param trigger =====
    const url = new URL(location.href);
    if(url.searchParams.get('toast')) toast(url.searchParams.get('toast'));
  </script>
</body>
</html>
